import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Scan, AlertTriangle, Shield, Bug, Clock, Play, Pause, CheckCircle2, XCircle, Target } from 'lucide-react';

const scanProfiles = [
  { id: 1, name: 'Full Network Scan', targets: 156, status: 'completed', duration: '2h 34m', vulns: 89 },
  { id: 2, name: 'Web Application Assessment', targets: 47, status: 'running', duration: '45m', vulns: 23 },
  { id: 3, name: 'API Security Audit', targets: 89, status: 'queued', duration: '-', vulns: 0 },
  { id: 4, name: 'Cloud Infrastructure Scan', targets: 34, status: 'completed', duration: '1h 12m', vulns: 45 },
];

const vulnerabilities = [
  { id: 'CVE-2024-1234', name: 'Remote Code Execution in Apache', severity: 'critical', cvss: 9.8, affected: 12, status: 'open' },
  { id: 'CVE-2024-5678', name: 'SQL Injection in User Auth', severity: 'critical', cvss: 9.1, affected: 3, status: 'open' },
  { id: 'CVE-2024-9012', name: 'Cross-Site Scripting (XSS)', severity: 'high', cvss: 7.5, affected: 28, status: 'remediated' },
  { id: 'CVE-2024-3456', name: 'Privilege Escalation via SUDO', severity: 'high', cvss: 7.8, affected: 8, status: 'open' },
  { id: 'CVE-2024-7890', name: 'Information Disclosure', severity: 'medium', cvss: 5.3, affected: 15, status: 'open' },
  { id: 'CVE-2024-2345', name: 'Weak SSL/TLS Configuration', severity: 'medium', cvss: 4.8, affected: 42, status: 'remediated' },
];

const severityColors = {
  critical: 'bg-destructive text-destructive-foreground',
  high: 'bg-warning text-warning-foreground',
  medium: 'bg-orange-500/20 text-orange-400',
  low: 'bg-success/20 text-success',
};

const statusIcons = {
  completed: <CheckCircle2 className="h-4 w-4 text-success" />,
  running: <Play className="h-4 w-4 text-primary animate-pulse" />,
  queued: <Clock className="h-4 w-4 text-muted-foreground" />,
  failed: <XCircle className="h-4 w-4 text-destructive" />,
};

export default function VulnerabilityScanner() {
  const [activeTab, setActiveTab] = useState('scans');

  return (
    <div className="p-6 space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-3">
          <div className="p-2 bg-warning/20 rounded-lg">
            <Scan className="h-6 w-6 text-warning" />
          </div>
          <div>
            <h1 className="text-2xl font-bold">Vulnerability Scanner</h1>
            <p className="text-muted-foreground">Automated security vulnerability detection and assessment</p>
          </div>
        </div>
        <Button className="gap-2 bg-warning hover:bg-warning/90 text-warning-foreground">
          <Play className="h-4 w-4" />
          New Scan
        </Button>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        <Card className="border-destructive/30 bg-destructive/5">
          <CardContent className="p-4">
            <div className="flex items-center gap-3">
              <Bug className="h-8 w-8 text-destructive" />
              <div>
                <div className="text-2xl font-bold text-destructive">157</div>
                <p className="text-xs text-muted-foreground">Critical & High Vulns</p>
              </div>
            </div>
          </CardContent>
        </Card>
        <Card className="border-warning/30 bg-warning/5">
          <CardContent className="p-4">
            <div className="flex items-center gap-3">
              <Target className="h-8 w-8 text-warning" />
              <div>
                <div className="text-2xl font-bold text-warning">326</div>
                <p className="text-xs text-muted-foreground">Assets Scanned</p>
              </div>
            </div>
          </CardContent>
        </Card>
        <Card className="border-success/30 bg-success/5">
          <CardContent className="p-4">
            <div className="flex items-center gap-3">
              <Shield className="h-8 w-8 text-success" />
              <div>
                <div className="text-2xl font-bold text-success">68%</div>
                <p className="text-xs text-muted-foreground">Remediation Rate</p>
              </div>
            </div>
          </CardContent>
        </Card>
        <Card className="border-primary/30 bg-primary/5">
          <CardContent className="p-4">
            <div className="flex items-center gap-3">
              <Clock className="h-8 w-8 text-primary" />
              <div>
                <div className="text-2xl font-bold text-primary">4.2 days</div>
                <p className="text-xs text-muted-foreground">Avg. Time to Fix</p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Main Content */}
      <Tabs value={activeTab} onValueChange={setActiveTab}>
        <TabsList>
          <TabsTrigger value="scans">Scan Profiles</TabsTrigger>
          <TabsTrigger value="vulnerabilities">Vulnerabilities</TabsTrigger>
        </TabsList>

        <TabsContent value="scans" className="mt-4">
          <Card className="border-border/50">
            <CardContent className="p-0">
              <div className="divide-y divide-border">
                {scanProfiles.map((scan) => (
                  <div key={scan.id} className="flex items-center justify-between p-4 hover:bg-muted/30 transition-colors">
                    <div className="flex items-center gap-4">
                      <div className="w-10 h-10 rounded-lg bg-warning/10 flex items-center justify-center">
                        <Scan className="h-5 w-5 text-warning" />
                      </div>
                      <div>
                        <div className="font-medium">{scan.name}</div>
                        <div className="text-sm text-muted-foreground">
                          {scan.targets} targets • Duration: {scan.duration}
                        </div>
                      </div>
                    </div>
                    <div className="flex items-center gap-4">
                      {scan.vulns > 0 && (
                        <Badge variant="outline" className="gap-1">
                          <Bug className="h-3 w-3" />
                          {scan.vulns} vulns
                        </Badge>
                      )}
                      <div className="flex items-center gap-2">
                        {statusIcons[scan.status as keyof typeof statusIcons]}
                        <span className="text-sm capitalize">{scan.status}</span>
                      </div>
                      {scan.status === 'running' && (
                        <Button variant="outline" size="sm">
                          <Pause className="h-4 w-4" />
                        </Button>
                      )}
                      {scan.status === 'completed' && (
                        <Button variant="outline" size="sm">View Report</Button>
                      )}
                    </div>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="vulnerabilities" className="mt-4">
          <Card className="border-border/50">
            <CardContent className="p-0">
              <div className="divide-y divide-border">
                {vulnerabilities.map((vuln) => (
                  <div key={vuln.id} className="flex items-center justify-between p-4 hover:bg-muted/30 transition-colors">
                    <div className="flex items-center gap-4">
                      <Badge className={severityColors[vuln.severity as keyof typeof severityColors]}>
                        {vuln.severity.toUpperCase()}
                      </Badge>
                      <div>
                        <div className="font-medium">{vuln.name}</div>
                        <div className="flex items-center gap-3 text-sm text-muted-foreground">
                          <span className="font-mono">{vuln.id}</span>
                          <span>•</span>
                          <span>CVSS: {vuln.cvss}</span>
                          <span>•</span>
                          <span>{vuln.affected} affected systems</span>
                        </div>
                      </div>
                    </div>
                    <div className="flex items-center gap-3">
                      <Badge variant={vuln.status === 'open' ? 'destructive' : 'outline'}>
                        {vuln.status}
                      </Badge>
                      <Button variant="outline" size="sm">Details</Button>
                    </div>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>
    </div>
  );
}
